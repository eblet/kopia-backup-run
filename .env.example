# =============================================================================
# KOPIA BACKUP SYSTEM CONFIGURATION
# =============================================================================

# -----------------------------------------------------------------------------
# SECURITY CONFIGURATION
# -----------------------------------------------------------------------------
# Repository and Server Authentication
KOPIA_REPO_PASSWORD=              # Repository password (min 16 chars)
KOPIA_SERVER_USERNAME=            # Server username (min 8 chars)
KOPIA_SERVER_PASSWORD=            # Server password (min 16 chars)

# TLS Security
KOPIA_SECURE_MODE=false          # Enable TLS (true/false)
KOPIA_TLS_CERT_PATH=/etc/kopia/cert.pem  # TLS certificate path
KOPIA_SERVER_ALLOWED_IPS=        # Allowed IPs (CIDR format, comma-separated)

# -----------------------------------------------------------------------------
# NETWORK CONFIGURATION
# -----------------------------------------------------------------------------
# Kopia Network
KOPIA_SERVER_IP=                 # Server IP address
KOPIA_SERVER_PORT=51515          # Server port (1-65535)
KOPIA_NETWORK_NAME=kopia_network # Docker network name

# Monitoring Network
MONITORING_NETWORK_NAME=monitoring_network
MONITORING_NETWORK_DRIVER=bridge

# -----------------------------------------------------------------------------
# DIRECTORY PATHS
# -----------------------------------------------------------------------------
# Base Paths
KOPIA_BASE_DIR=/var/lib/kopia    # Base directory for Kopia data
KOPIA_REPO_PATH=${KOPIA_BASE_DIR}/repository  # Repository location
KOPIA_LOG_DIR=/var/log/kopia     # Log directory

# Client Paths
KOPIA_CONFIG_DIR=~/.config/kopia # Client configuration directory
KOPIA_CACHE_DIR=~/.cache/kopia   # Cache directory

# Container Paths (DO NOT MODIFY)
KOPIA_CONTAINER_CONFIG_DIR=/app/config
KOPIA_CONTAINER_CACHE_DIR=/app/cache

# -----------------------------------------------------------------------------
# NAS CONFIGURATION
# -----------------------------------------------------------------------------
NAS_IP=                         # NAS IP address
NAS_SHARE=                      # NFS share path
NAS_MOUNT_PATH=/mnt/nas         # Local mount point
NAS_MOUNT_OPTIONS="rw,sync,hard,intr,rsize=32768,wsize=32768,noatime"
NAS_TIMEOUT=30                  # Mount timeout (seconds)

# -----------------------------------------------------------------------------
# PERFORMANCE TUNING
# -----------------------------------------------------------------------------
# Parallel Processing
KOPIA_PARALLEL_CLIENT=4         # Client parallel operations
KOPIA_PARALLEL_SERVER=2         # Server parallel operations

# Cache and Bandwidth
KOPIA_CACHE_SIZE=5G            # Cache size
KOPIA_UPLOAD_LIMIT=0           # Upload speed limit (bytes/s, 0=unlimited)
KOPIA_DOWNLOAD_LIMIT=0         # Download speed limit (bytes/s, 0=unlimited)

# Resource Limits
KOPIA_CLIENT_CPU_LIMIT=4       # Client CPU cores limit
KOPIA_CLIENT_MEM_LIMIT=4G      # Client memory limit
KOPIA_SERVER_CPU_LIMIT=2       # Server CPU cores limit
KOPIA_SERVER_MEM_LIMIT=2G      # Server memory limit

# -----------------------------------------------------------------------------
# BACKUP CONFIGURATION
# -----------------------------------------------------------------------------
# Backup Settings
BACKUP_COMPRESSION=zstd-fastest # Compression (zstd-fastest|zstd-default|zstd-max)
BACKUP_VERIFY=true             # Verify after backup
BACKUP_RETENTION_DAYS=7        # Local backup retention period

# Schedule
SERVER_SYNC_TIME="0 5 * * *"   # Server sync schedule (cron format)
CLIENT_BACKUP_TIME="0 2 * * *" # Client backup schedule (cron format)

# -----------------------------------------------------------------------------
# MONITORING CONFIGURATION
# -----------------------------------------------------------------------------
# General Settings
MONITORING_TYPE=all            # all, zabbix, prometheus, none
TZ=UTC                        # Timezone

# Logging
LOG_LEVEL=info               # Logging level (debug|info|warn|error)
LOG_MAX_SIZE=100M           # Max log file size
LOG_MAX_FILES=7             # Number of log files to keep

# Zabbix Configuration
ZABBIX_ENABLE=true
KOPIA_CONTAINER_NAME=kopia-server
ZABBIX_EXTERNAL_SCRIPTS=/usr/lib/zabbix/externalscripts
ZABBIX_AGENT_CONFIG=/etc/zabbix/zabbix_agentd.d

# Prometheus Configuration
PROMETHEUS_ENABLE=true
PROMETHEUS_SCRAPE_INTERVAL=15s
PROMETHEUS_EVAL_INTERVAL=15s
PROMETHEUS_SCRAPE_TIMEOUT=10s
PROMETHEUS_UI_PORT=9090
PROMETHEUS_DATA_DIR=/var/lib/prometheus
PROMETHEUS_RETENTION=15d
PROMETHEUS_VERSION=latest
PROMETHEUS_EXTERNAL_URL=http://localhost:9090

# Grafana Configuration
GRAFANA_VERSION=latest
GRAFANA_PORT=3000
GRAFANA_DATA_DIR=/var/lib/grafana
GRAFANA_ADMIN_PASSWORD=admin    # CHANGE THIS!
GRAFANA_EXTERNAL_URL=http://localhost:3000
GRAFANA_PLUGINS=grafana-piechart-panel,grafana-worldmap-panel

# Node Exporter
NODE_EXPORTER_VERSION=latest
NODE_EXPORTER_PORT=9100

# Kopia Exporter
KOPIA_EXPORTER_PORT=9091

# Users and Groups
PROM_USER=65534
PROM_GROUP=65534
GRAFANA_USER=472
GRAFANA_GROUP=472

# -----------------------------------------------------------------------------
# VOLUME CONFIGURATION
# -----------------------------------------------------------------------------
# JSON configuration for backup volumes
DOCKER_VOLUMES='{
    "/path/to/data": {
        "name": "app-data",
        "tags": ["type:data", "app:myapp"],
        "compression": "zstd-fastest",
        "exclude": ["*.tmp", "*.log"],
        "priority": 1
    },
    "/path/to/config": {
        "name": "app-config",
        "tags": ["type:config", "app:myapp"],
        "compression": "zstd-max",
        "priority": 2
    }
}'