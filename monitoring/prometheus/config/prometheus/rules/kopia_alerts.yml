groups:
  - name: kopia_alerts
    rules:
      - alert: KopiaBackupTooOld
        expr: time() - kopia_backup_last_success > 86400
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "Backup too old (> 24h)"
          description: "Last successful backup was {{ $value | humanizeDuration }} ago"
          
      - alert: KopiaBackupFailed
        expr: kopia_backup_validation == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Backup validation failed"
          description: "Last backup validation check failed"

      - alert: KopiaRepositoryGrowth
        expr: rate(kopia_repository_size_bytes[1d]) > 1e9
        for: 1d
        labels:
          severity: warning
        annotations:
          summary: "Unusual repository growth"
          description: "Repository growing faster than 1GB/day"

      - alert: KopiaExporterDown
        expr: up{job="kopia-exporter"} == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Kopia exporter is down"
          description: "Kopia metrics are not available" 